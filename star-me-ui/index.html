<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
  <meta name="description" content="">
  <meta name="author" content="">

  <title>夸我</title>

  <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="styles/main.css" rel="stylesheet">
</head>

<body uku-application>

  <navigator-bar uku-login-user="appCtrl.loginUser"></navigator-bar>
  <jumbotron id="jumbotron"></jumbotron>
  <filter-bar></filter-bar>
  <content-list uku-search-results="appCtrl.searchResults"></content-list>
  <my-footer></my-footer>

  <comment-modal></comment-modal>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>
  <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="bower_components/ukulelejs/dist/uku.js"></script>
  <script src="bower_components/ukulelejs/dist/polyfill/custom_event.js"></script>
  <script>
    var uku = new Ukulele();
    uku.registerComponent('navigator-bar','components/navigator-bar.html');
    uku.registerComponent('jumbotron','components/jumbotron.html');
    uku.registerComponent('filter-bar','components/filter-bar.html');
    uku.registerComponent('content-list','components/content-list.html');
    uku.registerComponent('repo-item','components/repo-item.html');
    uku.registerComponent('my-footer','components/footer.html');
    uku.registerComponent('comment-modal','components/comment-modal.html');
    var appCtrl = new ApplicationController(uku);
    uku.registerController('appCtrl',appCtrl);

    uku.addListener(Ukulele.INITIALIZED,function(){
      $.get('/api/authenticatedUser',function(result){
        if(result){
          appCtrl.loginUser = result;
          console.log('login success');
          uku.refresh('appCtrl');
        }else{
          console.log('not login');
        }  
      });
      appCtrl.registerListener();
    });

    uku.init();

    function ApplicationController(uku){
      var self = this;
      this.loginUser = null;
      this.registerListener = function(){
        document.getElementById('jumbotron').addEventListener('dosearch',function(event){
          var keyword = event.data.keyword;
          if(keyword){
            $.get('api/search/' + encodeURIComponent(keyword),function(result){
              //console.log(result);
              self.searchResults = result.items;
              uku.refresh('appCtrl');
            });
          }else{

          }
        });
      };
      // this.searchHandler = function(event,data){
        
      // };
    }

    
  </script>
</body>

</html>